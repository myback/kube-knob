---
kube_version: v1.20.1
cni_version: v0.9.0
crictl_version: v1.20.0
containerd_version: v1.3.9
etcdctl_ver: v3.4.14

bin_dir: /usr/local/bin
cni_bin_dir: /opt/cni/bin
cni_conf_dir: /etc/cni/net.d

use_download_cache: false
cache_server_host: '{% if use_download_cache %}{{ hostvars[groups["cache"][0]].ip | default(hostvars[groups["cache"][0]].ansible_host) }}{% endif %}'
cache_server_port: 8989

# For testing
storage_google: http://172.17.8.1:8088
cni_url: '{{ storage_google }}/cni-plugins-linux-amd64-{{ cni_version }}.tgz'
containerd_url: '{{ storage_google }}/containerd-{{ containerd_version | regex_replace("v") }}-linux-amd64.tar.gz'
crictl_url: '{{ storage_google }}/crictl-{{ crictl_version }}-linux-amd64.tar.gz'

# cni_url: 'https://github.com/containernetworking/plugins/releases/download/{{ cni_version }}/cni-plugins-linux-amd64-{{ cni_version }}.tgz'
# containerd_url: 'https://github.com/containerd/containerd/releases/download/{{ containerd_version }}/containerd-{{ containerd_version | regex_replace("v") }}-linux-amd64.tar.gz'
# crictl_url: 'https://github.com/kubernetes-sigs/cri-tools/releases/download/{{ crictl_version }}/crictl-{{ crictl_version }}-linux-amd64.tar.gz'

# etcdctl_url: 'https://storage.googleapis.com/etcd/{{etcdctl_ver}}/etcd-{{etcdctl_ver}}-linux-amd64.tar.gz'
# storage_google: 'https://storage.googleapis.com/kubernetes-release/release/{{ kube_version }}/bin/linux/amd64'
kubeadm_url: '{{ storage_google }}/kubeadm'
kubectl_url: '{{ storage_google }}/kubectl'
kubelet_url: '{{ storage_google }}/kubelet'
# etcdctl_url: '{{ storage_google }}/etcd-{{etcdctl_ver}}-linux-amd64.tar.gz'

kube_download_list:
  - name: cni
    url: '{{ cni_url }}'
    dir: '{{ cni_bin_dir }}'
    checksum: sha1:ec06b9603044f761d86b32fd075e53b9b42eecc5
    groups:
    - k8s
  - name: containerd
    url: '{{ containerd_url }}'
    dir: /usr/local
    checksum: sha1:b39b7ef24548ceac8087599ac30b54e08fd68ba2
    groups:
    - k8s
  - name: crictl
    url: '{{ crictl_url }}'
    checksum: sha1:eaf4ffa1cfac5c69ec522d9562c8ee6ddd873f3e
    groups:
    - k8s
  - name: kubeadm
    url: '{{ kubeadm_url }}'
    checksum: sha1:e5537a3b0c79c172627de68126ee745cd9df4378
    groups:
    - k8s
  - name: kubectl
    url: '{{ kubectl_url }}'
    checksum: sha1:79d74b4b7077c8401181c7c5bfdaec8db739eb84
    groups:
    - k8s-master
  - name: kubelet
    url: '{{ kubelet_url }}'
    checksum: sha1:2801aa6a867d572ef5a147de7f7a1b90a0f78205
    groups:
    - k8s

kube_download_list_cached: >-
  {%- set cached_list = [] -%}
  {%- for lst in kube_download_list -%}
  {%- if use_download_cache -%}
  {%- set _ = lst.update({"url": "http://" + cache_server_host + ":" + cache_server_port | string + "/" + lst.url | basename }) -%}
  {%- endif -%}
  {%- set _ = cached_list.append(lst) -%}         
  {%- endfor -%}
  {{ cached_list }}

kernel_modules:
  - br_netfilter
  - ip_vs
  - ip_vs_rr
  - ip_vs_wrr
  - ip_vs_sh

sysctl_params:
  'net.ipv4.ip_forward': "1"
  'net.bridge.bridge-nf-call-iptables': "1"

cri_socket: /run/containerd/containerd.sock
registry_mirrors: {}
  # docker.io: ["host1", "host2"]

haproxy_frontend_port: 16443
kube_apiserver_anonymous_auth_disable: false
